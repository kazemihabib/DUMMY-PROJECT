# CDMO

## Table of Contents
- [Prerequisites](#prerequisites)
- [Building Docker Image](#building-docker-image)
- [Running Docker Image](#running-docker-image)
- [Activating the Virtual Environment](#activating-the-virtual-environment)
- [Running Solvers](#running-solvers)
  - [Running All Solvers](#running-all-solvers)
  - [Running the SMT Solver](#running-the-smt-solver)
  - [Running the CP Solver](#running-the-cp-solver)
  - [Running the MIP Solver](#running-the-mip-solver)
- [Examples](#examples)

## Prerequisites

Before you begin, ensure that you have the following installed:

- **Docker**: Install Docker on your host machine. You can download it from [Docker's official website](https://www.docker.com/get-started).
- **Python**: Version 3.6 or higher is required. We recommend using Python 3.10, as this is the version we tested.
- **pip**: Python's package installer.

## Building Docker Image

To build the Docker image:

1. Open your preferred terminal.
2. Navigate to the root of this project.
3. Run the following command:

   ```bash
   docker build -t cdmo .
   ```

   This will create an image named `cdmo`.

## Running Docker Image

To run the Docker image, execute the following command:

```bash
docker run -it --rm cdmo
```

This command will run the `cdmo` image and provide a bash shell for running the solvers.

**Optional1**: If you want to access the solution files generated by the solvers from your host machine, mount a directory from your host into the Docker container by adding `-v <host_res_directory>:<docker_res_directory>` option to the previous command

**Examples**

```bash
docker run -it --rm -v $(pwd)/docker_generated_files/res:/app/res cdmo

docker run -it --rm -v ~/docker_generated_files/res:/app/res cdmo
```

**Optional2**: If you have new instance files in your host that you want to solve, Again mount the new instances directory from your host into the Docker by adding `-v <host_new_instances_directory>:<docker_new_input_directory>`

**Examples**

```bash
docker run -it --rm -v $(pwd)/new_instances:/app/new_instances cdmo

docker run -it --rm -v ~/new_instances:/app/new_instances cdmo
```

You can use both *Optional1* and *Optional2* together

**Example**
```bash
docker run -it --rm -v $(pwd)/docker_generated_files/res:/app/res -v $(pwd)/new_instances:/app/new_instances cdmo
```


Now, you have a prompt ready to run the solvers.

## Running Solvers

### Running All Solvers

To run all solvers:

```bash
python multi_solver.py <input_directory> <output_directory>
```

- `<input_directory>`: Directory containing the instance files.
- `<output_directory>`: Directory where the solutions will be saved as JSON files.

This will solve all instances in the input directory using *CP*, *SMT* and *MIP* and save the results in the output directory.

**Example**:

```bash
python3 multi_solver.py Instances/ res/
```
### Running the SMT Solver

To run the SMT solver:

```bash
python SMT/SMT_Z3.py <input_directory> <output_directory> <sb|nosb|both>
```

Arguments:
- `<input_directory>`: Directory containing the instance files.
- `<output_directory>`: Directory to save the solutions as JSON files.
- `<sb|nosb|both>`: Symmetry breaking options:
  - `both`: Run both with and without symmetry breaking.
  - `sb`: Enable symmetry breaking.
  - `nosb`: Disable symmetry breaking.

**Examples**

To run the SMT Solver with symmetry breaking enabled:

```bash
python3 SMT/SMT_Z3.py Instances res/SMT sb
```

To run the SMT Solver without symmetry breaking:

```bash
python3 SMT/SMT_Z3.py Instances res/SMT nosb
```

To run the SMT Solver with and without symmetry breaking:

```bash
python3 SMT/SMT_Z3.py Instances res/SMT both
```
### Running the CP Solver

To run the CP solver:

```bash
python CP/run_cp.py <input_directory> <output_directory>
```

Arguments:
- `<input_directory>`: Directory containing the instance files.
- `<output_directory>`: Directory to save the solutions as JSON files.

The script will run three different minizinc solvers using each "chuffed" or "gecode". The solvers include:
- `CP_SYM_LB_RML_HRSTIC`: Uses Symmetry-breaking, Lower-bound constraint, Route Matrix Limiting and non-trivial Heuristics.
- `CP_SYM_LB`: Uses only Symmetry-breaking and Lower-bound constraint.
- `CP`: The simplest solver without Symmetry-breaking or LB constraint. 


### Running the MIP solver

TODO